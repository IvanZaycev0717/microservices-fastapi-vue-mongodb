{
	"info": {
		"_postman_id": "55ffda5d-4ee7-442a-bd3c-0a63b29b9296",
		"name": "Content Admin API",
		"description": "Тесты для микросервиса админки контента",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "24875435"
	},
	"item": [
		{
			"name": "Happy Paths",
			"item": [
				{
					"name": "About Endpoints",
					"item": [
						{
							"name": "/about - 200 (Get all documents)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/about",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about - 200 (Wrong Query-param)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200 even with invalid lang\", () => pm.response.to.have.status(200));"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/about?lang=invalid",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about"
									],
									"query": [
										{
											"key": "lang",
											"value": "invalid"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "/about - 201 (Create new document)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 201 Created\", () => pm.response.to.have.status(201));\r",
											"pm.test(\"Returns document ID\", () => {\r",
											"    const response = pm.response.text();\r",
											"    pm.expect(response).to.include(\"Document created with _id=\");\r",
											"});\r",
											"const raw = pm.response.text().split(\"_id=\")[1];\r",
											"const docId = raw.substring(0, raw.length - 1);\r",
											"pm.collectionVariables.set(\"document_id\", docId);"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "image",
											"type": "file",
											"src": "test-image.jpg"
										},
										{
											"key": "title_en",
											"value": "Test Title EN",
											"type": "text"
										},
										{
											"key": "description_en",
											"value": "Test Description EN",
											"type": "text"
										},
										{
											"key": "title_ru",
											"value": "Тест заголовок RU",
											"type": "text"
										},
										{
											"key": "description_ru",
											"value": "Тест описание RU",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{base_url}}/about",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about/docId - 200 (Get created document)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200 OK\", () => pm.response.to.have.status(200));\r",
											"pm.test(\"Has image_url\", () => {\r",
											"    const jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.image_url).to.be.a('string');\r",
											"    pm.collectionVariables.set(\"image_url\", jsonData.image_url);\r",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/about/{{document_id}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about",
										"{{document_id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about/docId - 200 (Update String Fields)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200 OK\", () => pm.response.to.have.status(200));\r",
											"pm.test(\"Update successful\", () => {\r",
											"    const jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.message).to.eql(\"Document updated successfully\");\r",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "PATCH",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "title_en",
											"value": "Updated Title EN",
											"type": "text"
										},
										{
											"key": "description_ru",
											"value": "Обновленное описание RU",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{base_url}}/about/{{document_id}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about",
										"{{document_id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about/docId - 200 (Update Image)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200 OK\", () => pm.response.to.have.status(200));\r",
											"pm.test(\"Image updated\", () => {\r",
											"    const jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.image_url).to.be.a('string');\r",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "PATCH",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "image",
											"type": "file",
											"src": "test-image2.jpg"
										}
									]
								},
								"url": {
									"raw": "{{base_url}}/about/{{document_id}}/image",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about",
										"{{document_id}}",
										"image"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about/docId - 204 (Delete Document)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 204 No Content\", () => pm.response.to.have.status(204));"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "DELETE",
								"header": [],
								"url": {
									"raw": "{{base_url}}/about/{{document_id}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about",
										"{{document_id}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Tech Endpoints",
					"item": []
				}
			]
		},
		{
			"name": "Negative Tests",
			"item": [
				{
					"name": "About Endpoints",
					"item": [
						{
							"name": "/about - 422 (Missing Image)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 422 for unable process\", () => pm.response.to.have.status(422));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "image",
											"value": "",
											"type": "text"
										},
										{
											"key": "description_en",
											"value": "Test Description EN",
											"type": "text"
										},
										{
											"key": "description_ru",
											"value": "Тест описание RU",
											"type": "text"
										},
										{
											"key": "title_en",
											"value": "Test Title EN",
											"type": "text"
										},
										{
											"key": "title_ru",
											"value": "Тест заголовок RU",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{base_url}}/about",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about - 400 (Wrong Image Format)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 400 for invalid file format\", () => pm.response.to.have.status(400));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "image",
											"type": "file",
											"src": "wrong-format.txt"
										},
										{
											"key": "description_en",
											"value": "Test Description EN",
											"type": "text"
										},
										{
											"key": "description_ru",
											"value": "Тест описание RU",
											"type": "text"
										},
										{
											"key": "title_en",
											"value": "Test Title EN",
											"type": "text"
										},
										{
											"key": "title_ru",
											"value": "Тест заголовок RU",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{base_url}}/about",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about"
									]
								}
							},
							"response": []
						},
						{
							"name": "/about/wrong_id - 400 (Not MongoDB ID)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 400 for invalid ObjectId\", () => pm.response.to.have.status(400));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/about/wrong-id",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"about",
										"wrong-id"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000"
		},
		{
			"key": "document_id",
			"value": ""
		},
		{
			"key": "image_url",
			"value": ""
		},
		{
			"key": "unexisted_document_id",
			"value": "507f1f77bcf86cd799439011",
			"description": {
				"content": "",
				"type": "text/plain"
			}
		}
	]
}